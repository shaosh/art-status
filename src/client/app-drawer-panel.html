<link rel="import" href="/pages/app-main.html">
<link rel="import" href="/pages/job-card.html">

<dom-module id="app-drawer-panel">
  <style>
    paper-tab{
      background: #5E6FC7;
      color:#fff;
    }
    
    :host{
      --paper-tabs-selection-bar-color: #7EC1F4;
    }
    
    .newjob{
      padding: 10px 20px;
      text-align: center;
      background-color: #F2FD8E;
    }
    
    .drawer{
      box-sizing:content-box;
      border-right: #132584 1px solid;
    }
    
    job-card{
      cursor: pointer;
    }
    
  </style>
  
  <template>
    <paper-drawer-panel drawer-width="400px">
      <paper-header-panel drawer mode="standard" class="drawer">
        <div class="paper-header">
          <paper-tabs selected="0" noink>
            <paper-tab>
              <paper-menu-button>
                <paper-button class="dropdown-trigger">
                  <span>ALL (<span>{{jobs.length}}</span>)</span>
                  <iron-icon icon="expand-more"></iron-icon>
                </paper-button>
                <!--<paper-menu class="dropdown-content" selected="{{selectedIndex}}">-->
                <!--  <template is="dom-repeat" items="[[companies]]">-->
                <!--    <paper-item>[[item.name]]</paper-item>-->
                <!--  </template>-->
                <!--</paper-menu>-->
                </paper-menu-button>
            </paper-tab>
            <paper-tab>UNASSIGNED</paper-tab>
            <paper-tab>MINE</paper-tab>
          </paper-tabs>
          <div class="newjob"><a href="#">You have {n} new jobs.</a></div>
        </div>
        <template is="dom-repeat" items="{{jobs}}">
          <job-card job="{{item}}" on-click="selectJob"></job-card>
        </template>
      </paper-header-panel>
      <paper-header-panel main mode="standard">
        <div class="paper-header">
          <app-main job="{{selectedJob}}"></app-main>
        </div>
        <div> Main content... </div>
      </paper-header-panel>
    </paper-drawer-panel>
  </template>
  
  <script>
    Polymer({
      is: 'app-drawer-panel',
      selectJob: function(e){
        var card = Polymer.dom(e).localTarget.childNodes[1];
        if(card.classList.contains('selected')){
          return;
        }
        
        var prevSelected = Polymer.dom(this.root).querySelectorAll('job-card');
        if(prevSelected.length > 0){
          prevSelected.map(function(jobcard){
            jobcard.childNodes[1].toggleClass('selected', false);
          });
        }
        this.selectedJob = e.model.item;
        
        card.toggleClass('selected');
      },
      selectedJob: {
        type: Object,
        value: null,
        notify: true
      },
      ready: function(){
        if(this.jobs.length > 0){
          this.selectedJob = this.jobs[0];
        }
      },
      properties: {
        jobs:{
          type: Array,
          value: [
            {
              job: {
                id: '111111',
                name: 'For the dogs',
                time: '2015-08-15 00:00:22',
                status: 'Working',
                assignee: 'Jessie',
                updater: 'Aaron'
              }
            },
            {
              job: {
                id: '222222',
                name: 'For the dogs',
                time: '2015-08-20 23:11:22',
                status: 'Waiting',
                assignee: 'Mike',
                updater: 'Aaron'
              }
            },
            {
              job: {
                id: '333333',
                name: 'For the dogs',
                time: '2015-08-19 00:12:45',
                status: 'Locked',
                assignee: 'Bob',
                updater: 'Aaron'
              }
            },
            {
              job: {
                id: '444444',
                name: 'For the dogs',
                time: '2015-08-16 15:33:11',
                status: 'Done',
                assignee: 'Zack',
                updater: 'Aaron'
              }
            },
            {
              job: {
                id: '555555',
                name: 'For the dogs',
                time: '2015-08-17 07:13:56',
                status: 'Done',
                assignee: 'Sam',
                updater: 'Aaron'
              }
            },
            {
              job: {
                id: '666666',
                name: 'For the dogs',
                time: '2015-08-18 18:18:38',
                status: 'Working',
                assignee: 'Amy',
                updater: 'Aaron'
              }
            },
            {
              job: {
                id: '777777',
                name: 'For the dogs',
                time: '2015-08-15 00:00:22',
                status: 'Waiting',
                assignee: 'Hill',
                updater: 'Aaron'
              }
            }
          ]
        }
      }
    });
  </script>
</dom-module>
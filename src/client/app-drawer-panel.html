<link rel="import" href="app-main-header.html">
<link rel="import" href="app-main-body.html">
<link rel="import" href="job-card.html">

<dom-module id="app-drawer-panel">
  <style>
    paper-tab{
      background: #5E6FC7;
      color:#fff;
    }
    
    :host{
      --paper-tabs-selection-bar-color: #7EC1F4;
    }
    
    .newjob{
      padding: 10px 20px;
      text-align: center;
      background-color: #F2FD8E;
    }
    
    .drawer{
      box-sizing:content-box;
      border-right: #132584 1px solid;
    }
    
    job-card{
      cursor: pointer;
    }

    .content{
      width:100%;
      height:auto;
    }
    
  </style>
  
  <template>
    <paper-drawer-panel drawer-width="400px">
      <paper-header-panel drawer mode="standard" class="drawer">
        <div class="paper-header">
          <paper-tabs selected="0" noink>
            <paper-tab>
              <paper-menu-button>
                <paper-button class="dropdown-trigger">
                  <span>ALL (<span>{{jobs.length}}</span>)</span>
                  <iron-icon icon="expand-more"></iron-icon>
                </paper-button>
                <!--<paper-menu class="dropdown-content" selected="{{selectedIndex}}">-->
                <!--  <template is="dom-repeat" items="[[companies]]">-->
                <!--    <paper-item>[[item.name]]</paper-item>-->
                <!--  </template>-->
                <!--</paper-menu>-->
                </paper-menu-button>
            </paper-tab>
            <paper-tab>UNASSIGNED</paper-tab>
            <paper-tab>MINE</paper-tab>
          </paper-tabs>
          <div class="newjob"><a href="#">You have {n} new jobs.</a></div>
        </div>
        <template is="dom-repeat" items="{{jobs}}">
          <job-card job="{{item}}" on-click="selectJob"></job-card>
        </template>
      </paper-header-panel>
      <paper-header-panel main mode="standard">
        <div class="paper-header">
          <app-main-header job="{{selectedJob}}"></app-main-header>
        </div>
        <div class="content">
          <app-main-body job="{{selectedJob}}"></app-main-body>
        </div>
        <!-- <div> Main content... </div> -->
      </paper-header-panel>
    </paper-drawer-panel>
  </template>
  
  <script>
    Polymer({
      is: 'app-drawer-panel',

      attached: function(){
        this.addSelectedClass(this.selectedJob, null);
      },

      selectJob: function(e){
        var card = Polymer.dom(e).localTarget.childNodes[1];
        if(card.classList.contains('selected')){
          return;
        }
        
        this.unselectPrevJob();
        card.toggleClass('selected');
        this.selectedJob = e.model.item;
        window.location.hash = '#/' + this.selectedCompany.name + '/' + this.selectedJob.id;       
      },      

      addSelectedClass: function(newValue, oldValue){
        var jobcards = Polymer.dom(this.root).querySelectorAll('job-card');
        if(typeof jobcards === 'undefined' || jobcards.length === 0){
          return;
        }
        for(var i = 0; i < jobcards.length; i++){
          var idSpan = Polymer.dom(jobcards[i].childNodes[1]).querySelector('.jobid');
          if(newValue.id === idSpan.innerText){
            if(jobcards[i].childNodes[1].classList.contains('selected')){
            }
            else{
              this.unselectPrevJob();
              jobcards[i].childNodes[1].toggleClass('selected');
            }
            return;
          }
        }
        this.unselectPrevJob();
        jobcards[0].childNodes[1].toggleClass('selected');
      },

      unselectPrevJob: function(){
        var prevSelected = Polymer.dom(this.root).querySelectorAll('job-card');
        if(prevSelected.length > 0){
          prevSelected.map(function(jobcard){
            jobcard.childNodes[1].toggleClass('selected', false);
          });
        }
      },

      properties: {
        jobs:{
          type: Array,
          notify: true
        },
        selectedJob: {
          type: Object,
          notify: true,
          observer: 'addSelectedClass'
        },
      }
    });
  </script>
</dom-module>
<dom-module id="app-main-header">
  <style>
    .header-wrapper{
      width:100%;
    }
    .otherviewer{
      text-align: center;
      font-style: italic;
      color: #8A97DC;
    }
    .title-wrapper{
      overflow: hidden;
    }
    .title{
      float:left;
    }
    .subtitle{
      color: #B4BDEF;
    }
    paper-toolbar{
      background-color: #5E6FC7;
      padding: 20px;
    }
    paper-tab{
      background-color: #EEE;
    }
    paper-tab iron-icon{
      color: #767676;
    }
    paper-tabs paper-tab.iron-selected {
      color: #5A5A5A;
      background-color: #BDBDBD;
    }
    #relation-icon{
      margin-top: 4px;
      margin-left:20px;
      height:20px;
      color:#B2E281;
      cursor: pointer; 
      float:left;
    }
  </style>
  <template>
    <paper-toolbar class="medium-tall">
      <div class="header-wrapper">
        <div class="otherviewer">XXX is also viewing</div>
        <div class="title-wrapper">
          <div class="title"><span>{{jobname}}</span></div>
          <iron-icon icon="av:library-books" id="relation-icon" on-click="showRelation"></iron-icon>
        </div>
        <div class="subtitle">{{statusTitle}}</div>
      </div>
    </paper-toolbar>
    <paper-tabs id="funcTab" selected="{{tab}}" no-bar noink>
      <paper-tab>
        <iron-icon icon="communication:message"></iron-icon>
      </paper-tab>
      <paper-tab>
        <iron-icon icon="social:person-add"></iron-icon>
      </paper-tab>
      <paper-tab>
        <iron-icon icon="communication:business"></iron-icon>
      </paper-tab>
      <paper-tab>
        <iron-icon icon="image:brush"></iron-icon>
      </paper-tab>
      <paper-tab>
        <iron-icon icon="file-upload"></iron-icon>
      </paper-tab>
    </paper-tabs>
    <content></content>
  </template>
  
  <script>
    Polymer({
      is: 'app-main-header',
      properties: {
        job: {
          type: Object,
          value: null,
          notify: true,
          observer: 'setJobData'
        },
        jobid: {
          type: String,
          notify: true
        },
        jobname: {
          type: String,
          notify: true
        },
        time: {
          type: String,
          notify: true
        },
        status: {
          type: String,
          notify: true
        },
        assignee: {
          type: String,
          notify: true
        },
        updater: {
          type: String,
          notify: true
        },
        statusTitle: {
          type: String,
          notify: true
        },
        viewurl:{
          type: String,
          notify: true
        },
        tab: {
          type: String,
          notify: true,
          value: 0
        }
      },
      setJobData: function(newValue, oldValue){
        if(!!newValue){
          this.jobid = newValue.id;
          this.jobname = newValue.name;
          this.time = moment(newValue.updatedAt).format("MMM DD, YYYY, h:mm:ss a");
          this.assignee = newValue.username;
          this.status = newValue.status;
          this.statusTitle = this.status + '. Updated at ' + this.time; 
          this.getRelation();
        }
      },
      getRelation: function(){
        var that = this,
          defer = Q.defer(),
          options = {
            url: RELATION_URL,
            headers:HEADER,
            method: 'POST',
            json: true,
            body: { 
            }
          };

        request(options, function(error, response, body){
            var obj = JSON.parse(body);
            console.log('relation', obj);
            // if(!error && response.statusCode === 200){
            //   if(!!obj && !!obj.cards && obj.cards.length > 0){
            //     that.processCards(obj.cards);
            //   }
            //   else if(!!obj && !!obj.cards && obj.cards.length === 0){
            //     that.cards = [];
            //     that.$$('.uploadPanel').style.display = 'block';
            //     that.$$('.viewPanel').style.display = 'none';
            //   }
            // }
            // else{
            //   outputError(!!error ? 'GetCards Error' + error : response.statusCode);
            // }
          }
        );
      },
      showRelation: function(e){
        alert(1111);
      }
    });
  </script>
</dom-module>
<dom-module id="company-selector">
  <style>
	  paper-item{
	    cursor:pointer;
	  }
	  .dropdown-trigger{
	    font-size:20px;
	  }
	</style>
	
  <template>
    <paper-menu-button>
      <paper-button class="dropdown-trigger">
        <span>{{selectedCompany}}</span>
        <iron-icon icon="expand-more"></iron-icon>
      </paper-button>
      <paper-menu class="dropdown-content" selected="{{selectedIndex}}">
        <template is="dom-repeat" items="[[companies]]">
          <paper-item>[[item.name]]</paper-item>
        </template>
      </paper-menu>
    </paper-menu-button>
  </template>
  <script>
    
    Polymer({
      is: 'company-selector',
      
      properties:{
        selectedCompany:{
          type: String,
          value: ''
        },
        
        selectedIndex:{
          type: Number,
          notify: true,
          observer: '_updateCompany'
        },
        
        companies:{
          type: Array,
          value: []
        }
      },
      
      ready: function(){
        this._initCompanies();
        if(this.companies.length > 0){
          var that = this;
          var fn = function(){
            return function(){
              that._setCompanyWithHash(that.companies);
            };
          };
          var prevOnHashChange = window.onhashchange;
          window.onhashchange = function(){
            (fn())();
            if(typeof prevOnHashChange === 'function'){
              prevOnHashChange();
            }            
          };
          if(this._setCompanyWithHash(this.companies)){
            return;
          }
          this.selectedIndex = 0;
        }
      },

      _setCompanyWithHash: function(companies){
        var hash = window.location.hash;
        console.log(hash);
        if(hash !== ''){
          var params = hash.split('/');
          for (var i = 0; i < companies.length; i++){
            if(params.length > 1 && params[1] === companies[i].name.toLowerCase()){
              this.selectedIndex = i;
              return true;
            }
          }
        }
        return false;
      },
      
      //TODO: hardcode to ajax calls
      _initCompanies: function(){
        this.push('companies', {name: 'DesignAShirt'});
        this.push('companies', {name: 'AntonSports'});
      },
      
      _updateCompany: function(newValue, oldValue){
        this.selectedCompany = this.companies[newValue].name;
      }
    });
  </script>
</dom-module>